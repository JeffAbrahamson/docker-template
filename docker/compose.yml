services:
  dev-base:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: compile-for-dev
    image: dev-build
    volumes:
      - ..:/devsrc
    environment:
      SSH_AUTH_SOCK: /ssh-agent
      SSH_USER: ${LOGNAME}

  dev-compile:
    extends: dev-base
    image: dev-build
    command: >
      /bin/bash -c "
      make -C . -j $(nproc) -k"

  dev-sh:
    extends: dev-base
    image: dev-sh
    command: sleep infinity

  # Interactive shell with Claude Code
  dev-claude:
    extends: dev-base
    build:
      target: compile-for-claude
    command: sleep infinity
    environment:
      HOME: /home/dev
    volumes:
      - ~/.claude:/home/dev/.claude
      - ~/.claude.json:/home/dev/.claude.json
